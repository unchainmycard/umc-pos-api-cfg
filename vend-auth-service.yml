# UMC POS Vend Auth Service - Externalized Configuration
#
# This configuration is served by Config Server to the vend-auth-service.
# See: ADR-F-pos-credential-storage-002, ADR-P-config-service-020

spring:
  # MongoDB Configuration (ADR-P-local-storage-007)
  data:
    mongodb:
      uri: ${VEND_AUTH_MONGODB_URI:mongodb://localhost:27017/umc_pos_vend_auth}
      auto-index-creation: true

  # RabbitMQ Configuration (ADR-P-module-communication-005)
  rabbitmq:
    host: ${RABBITMQ_HOST:localhost}
    port: ${RABBITMQ_PORT:5672}
    username: ${RABBITMQ_USERNAME:guest}
    password: ${RABBITMQ_PASSWORD:guest}
    virtual-host: ${RABBITMQ_VHOST:/}

  # Jackson
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# Eureka Client Configuration (ADR-P-service-discovery-021)
eureka:
  client:
    service-url:
      defaultZone: http://${EUREKA_USER:eureka}:${EUREKA_PASSWORD:eureka}@${EUREKA_HOST:localhost}:${EUREKA_PORT:8761}/eureka/
    fetch-registry: true
    register-with-eureka: true
  instance:
    prefer-ip-address: ${EUREKA_PREFER_IP:false}
    instance-id: ${spring.application.name}:${STORE_ID:local}:${STATION_ID:${random.uuid}}
    metadata-map:
      zone: ${STORE_ID:central}
      store-id: ${STORE_ID:}
      station-id: ${STATION_ID:}
      station-type: ${STATION_TYPE:pos}

# Actuator Endpoints (ADR-P-observability-017)
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus,metrics
  endpoint:
    health:
      show-details: when-authorized
      probes:
        enabled: true
  health:
    mongo:
      enabled: true

# OpenAPI Configuration (ADR-P-api-protocol-004)
springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html

# Feign Client Configuration
spring.cloud.openfeign:
  client:
    config:
      token-service:
        connect-timeout: 5000
        read-timeout: 5000
      user-service:
        connect-timeout: 5000
        read-timeout: 5000

# Logging Configuration
logging:
  level:
    root: INFO
    com.umc.pos.vendauth: INFO
    org.springframework.security: WARN
    org.springframework.data.mongodb: WARN

---
# Docker profile
spring:
  config:
    activate:
      on-profile: docker

  data:
    mongodb:
      uri: mongodb://${MONGODB_ROOT_USERNAME:admin}:${MONGODB_ROOT_PASSWORD:admin}@mongodb:27017/umc_pos_vend_auth?authSource=admin

  rabbitmq:
    host: rabbitmq
    port: 5672
    username: ${RABBITMQ_DEFAULT_USER:admin}
    password: ${RABBITMQ_DEFAULT_PASS:admin}
    virtual-host: ${RABBITMQ_VHOST:umc_pos}

eureka:
  instance:
    hostname: vend-auth-service
    prefer-ip-address: true
  client:
    service-url:
      defaultZone: http://${EUREKA_USER:eureka}:${EUREKA_PASSWORD:eureka}@discovery-service:8761/eureka/

logging:
  level:
    com.umc.pos.vendauth: DEBUG
